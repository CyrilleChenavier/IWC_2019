\documentclass[10pt]{easychair}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath,amssymb,mathrsfs}
\usepackage{tikz}
\usepackage{tikz-cd}
\usepackage{enumitem}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{property}[theorem]{Property}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}

% Newcommand

%Titre article
\newcommand\titlePaper{Strategies in algebraic rewriting, with applications to rational Weyl algebras}

% Texte
\newcommand\eg{\emph{e.g.}}
\newcommand\ie{\emph{i.e.}}
\newcommand\G{Gröbner}
\newcommand\todo[1]{{\bf\textcolor{red}{#1}}}
\newcommand\fixmecc[1]{{\textcolor{blue}{{\bf Cyrille:} #1}}}
\newcommand\data{{\color{red}\bf data}}

% Raccourcis mathématiques
\DeclareMathOperator{\supp}{supp}
\newcommand\Span[1]{\langle#1\rangle}
\newcommand\diff[1]{\partial_{#1}}
\newcommand\D{\mathcal{D}}
\DeclareMathOperator{\lm}{lm}
\DeclareMathOperator{\lc}{lc}
\newcommand\basis{\mathscr{B}}
\newcommand\SigmaTheta{\Sigma_{\Theta}}
\newcommand\lambdaB{\lambda_\bullet}
\newcommand\ordS{<_S}

% Structures algébriques
\newcommand\K{\mathbb{K}}
\newcommand\Q{\mathbb{Q}}
\newcommand\R{\mathbb{R}} 
\newcommand\N{\mathbb{N}}
\newcommand\QX{\mathbb{Q}[x_1,\cdots,x_n]}
\newcommand\QXX{\mathbb{Q}(x_1,\cdots,x_n)}
\newcommand\KX{\K X}
\newcommand\Weyl[1]{B_{#1}(\Q)}
\newcommand\monBasis{\Mon(\Delta)}
\DeclareMathOperator{\Mon}{Mon}
\DeclareMathOperator{\im}{im}

% Réécriture dans les ev
\newcommand\rewR{\to_R}
\newcommand\rewS{\to_S}
\newcommand\parRew{\twoheadrightarrow}
\newcommand\parS{\twoheadrightarrow_S}
\newcommand\parTheta[1]{\twoheadrightarrow_{\Theta,#1}}

\newcommand\transRew{\overset{*}{\to}}
\newcommand\transR{\overset{*}{\to}_R}
\newcommand\transS{\overset{*}{\to}_S}
\newcommand\transParS{\overset{*}{\twoheadrightarrow}_S}
\newcommand\transParRew{\overset{*}{\twoheadrightarrow}}

\newcommand\rewEquiv{\overset{*}{\leftrightarrow}}
\newcommand\equivR{\overset{*}{\leftrightarrow}_R}


% Réécriture dans les algèbres de Weyl
\newcommand\rewTheta{\to_\Theta}
\newcommand\transTheta{\overset{*}{\to}_\Theta}
\newcommand\divInv[1]{\mid_{#1}}
\newcommand\RTheta{R_{\Theta}}
\newcommand\SThetaL{S_{\Theta,L}}
\DeclareMathOperator{\SNF}{{\it S}-NF}
\DeclareMathOperator{\SThetaLNF}{{\it S}_{\Theta,L}-NF}
\newcommand{\SThetaNF}[1]{{\it S}_{\Theta,#1}\operatorname{-NF}}

\bibliographystyle{plain}

\begin{document}

\title{Strategies in algebraic rewriting, \\ with application to rational Weyl algebras}

\author{
Cyrille Chenavier\inst{1}
\and
Maxime Lucas\inst{2}
}

\institute{
  Johannes Kepler University, Institute for Algebra\\
  \email{cyrille.chenavier@jku.at}
\and
Inria Rennes - Bretagne Atlantique, Gallinette team\\
\email{maxime.lucas@inria.fr}
}

\authorrunning{C. Chenavier and M. Lucas}
\titlerunning{\titlePaper}

\maketitle

\begin{abstract}  
  We study the confluence property for rewriting systems whose underlying set of
  terms admits a vector space structure. For that, we use deterministic
  reduction strategies. These strategies are based on the choice of standard
  reductions applied to basis elements.

  We provide a sufficient condition of confluence in terms of the kernel of the
  operator which computes standard normal forms. We present a local criterion to
  check the confluence property in this framework, and show that this criterion
  is related to the diamond lemma for terminating rewriting systems.

  Finally, we relate these strategies to the notion of involutive division on
  rational Weyl algebras, and completely characterise the strategies induced by
  an involutive division.
\end{abstract}

\tableofcontents

\section{Introduction}

Rewriting systems are computational models given by a set of syntactic
expressions and transformation rules used to simplify expressions into
equivalent ones. Since rewriting theory is applicable to different
problems of mathematics and computer science, it was developed for many
syntaxes of terms, \eg, strings, ($\Sigma-$, higher-order, infinitary)
terms, graphs, (commutative, noncommutative, vectors of) polynomials,
(linear combinations of) trees, (higher-dimensional) cells. Abstract
rewriting theory unifies these contexts and provides universal
formulations of rewriting properties, such as termination, normalisation
and (local) confluence. Newman's lemma is one of the most famous results 
of abstract rewriting and asserts that under termination hypothesis, 
local confluence implies confluence.
\medskip

In the context of rewriting over algebraic structures, the Newman's lemma
is used in conjunction with the critical pairs lemma to algorithmically
prove confluence. This is something fundamental since confluent rewriting
systems provide methods for solving decision problems, computing (linear,
homotopy) bases, Hilbert series, or free
resolutions~\cite{MR846601, MR2964639, MR1072284, MR1360005}. From these 
methods, one get constructive proofs of theoretical results, such as 
embedding, coherence or homological theorems~\cite{MR506890, MR0506423,
  MR3347996, MR3742562, MR265437, MR920522}, but also applications to 
problems coming from topics modelled by algebra, such as cryptography, 
analysis of (ordinary differential, partial derivative, time-delay) 
equations or control theory. For instance, much information of 
functional equations may be read over free resolutions: integrability
conditions, parametrization of solutions, existence of autonomous
curves~\cite{MR2233761, MR1308976}.
\medskip

When one considers algebraic structures with underlying vector spaces
operations, the conjunction of the Newman's lemma and the critical pairs lemma
is traditionally known under the name of diamond's lemma. In practice, this
lemma is used to test if a generating set of a polynomial ideal is a \G\ basis,
since confluent linear rewriting systems are usually induced by \G\ bases or one
of their numerous adaptations to different classes of algebras or
operads~\cite{MR506890, MR2202562, MR2667136, MR1044911, MR1299371}. As an
illustration of such a class, let us mention Weyl algebras that are models of
differential operators with polynomial coefficients. These algebras are composed
of polynomials over two sets of $n$ variables, the state variables
$x_1,\ldots,x_n$ and the vector field variables $\partial_1,\ldots,\partial_n$, and submitted to the
commutation rules
\[ \forall 1\leq i\neq j\leq n: \qquad x_ix_j=x_jx_i,
  \quad \partial_i\partial_j=\partial_j\partial_i, \quad \partial_ix_j=x_j\partial_i, \quad
\partial_ix_i=x_i\partial_i+1. \]
These relations represent classical rules from differential calculus: the
second one means that second order derivatives of smooth functions
commute, the third one means that $x_j$ is constant for differentiation
with respect to $x_i$ and the last one represents the Leibniz's rule for
differentiation with respect to $x_i$, that is,
$\partial_i(x_if)=x_i\partial_i(f)+f$, for any smooth function $f$.
\medskip

\paragraph{Terminology and conventions of rewriting theory.}

Throughout the paper, we use the standard terminology and conventions of
rewriting theory~\cite{MR1629216}. An {\em abstract rewriting system} is
a pair $(A,\to)$, where $A$ is a set and $\to$ is binary relation on $A$,
called {\em rewriting relation}. An element~$(a,b)\in\to$ is written
$a\to b$ and is called a {\em rewriting step}. A {\em normal form} for
$\to$ is an element $a\in A$ such that there is no $b\in A$ such that
$a\to b$. We denote by $\transRew$  (respectively,~$\rewEquiv$) the
closure of $\to$ under transitivity and reflexivity (respectively, and
symmetry). The equivalence class of $a\in A$ modulo the equivalence
relation $\rewEquiv$ is written $[a]_{\rewEquiv}$ and the set of all
equivalence classes is written $A/\rewEquiv$. When $a\transRew b$, that
is, there exists a (possibly empty) finite sequence of rewriting steps
from $a$ to  $b$, we say that $a$ {\em rewrites} into $b$. The rewriting
relation $\to$ is said to be {\em confluent} if whenever $a\transRew b$
and $a\transRew c$, then $b$ and $c$ are {\em joinable}, that is, there
exists $d$ such that $b\transRew c$ and $c\transRew d$. The confluence
property is equivalent to the {\em Church-Rosser property} that assterts
that whenever $a\rewEquiv b$, then~$a$ and $b$ are joinable.

\section{A weak version of the diamond lemma}
\label{sec:a_weak_version_of_the_diamond_lemma}

In this section, we introduce parallel rewriting relations and rewriting
strategies for rewriting systems over vector spaces. We deduce a
confluence criterion in terms of strategies as well as a method based on
strategies to construct linear bases of vector spaces. We also obtain a
new proof of the diamond lemma.
\medskip

Throughout the section, we fix a ground field $\K$, a $\K$-vector space
$V$, and a basis $\basis$ of $V$. We say vectors and basis elements for
elements of $V$ and $\basis$, respectively. Every vector $v$ admits a
unique finite decomposition with respect to the basis $\basis$ and
coefficients in the ground field:

\begin{equation}\label{equ:vector_decompo}
  v=\sum\lambda_ie_i,\quad\lambda_i\neq 0.
\end{equation}
The set of basis elements which appear in the decomposition
\eqref{equ:vector_decompo} is called the {\it support} of $v$ and is
written $\supp(v)$. 

\subsection{Strategies on linear rewriting systems}
\label{sec:strategies_on_linear_rewriting_systems}

In this section, we introduce parallel rewriting relations and rewriting
strategies on vector spaces, and we construct a normalisation operator
associated to a strategy. This normalisation operator is used in
Section~\ref{sec:confluence_relative_to_a_strategy} to formulate our
confluence criterion and to provide a rewriting method for constructing
linear bases of vector spaces. 
\medskip

We first recall the traditional approach of rewriting over vector spaces,
which consists in reducing one basis element at each step. We fix a
subset $R$ of $\basis\times V$, whose elements are called
{\em rewriting rules}. A rewriting rule is denoted by $e\rewR v$, where
$e$ and~$v$ are left and right-hand sides of this rule, \ie, its images
through the natural projections of $R$  on~$\basis$ and $V$,
respectively. We extend these rules into a rewriting relation on $V$,
still written $\rewR$, where the rewriting steps are of the following
form: 
\begin{equation}\label{equ:R_rewriting_step}
  \lambda e+u\rewR\lambda v+u,
  \smallskip
\end{equation}
where $e\rewR v\in R$ is a rewriting rule, $\lambda$ is a nonzero scalar
and $u$ is a vector such that $e$ does not belong to its support. A
normal form for $\rewR$ is called an {\em R-normal form}. In the sequel, 
we refer~$\rewR$ as the rewriting relation induced by the rewriting rules
$R$. The relation~$\rewR$ is not stable under vector space
operations, that is, $u\rewR u'$ and $v\rewR v'$ generally do not imply 
$u+\lambda v\rewR u'+\lambda v'$. The following proposition shows that
$\equivR$ is compatible with these operations.
\smallskip

\begin{proposition}\label{prop:vs_structure}
  The quotient set $V/\equivR$ is a vector space and the projection
  $V\to V/\equivR$ is a linear map.
\end{proposition}

\begin{proof}
  The proof is an adaptation
  of~\cite[Lemma 3.1.3]{GuiraudHoffbeckMalbos19}. We only have to show
  that $u_1\equivR u_2$ and $v_1\equivR v_2$ imply
  $\mu u_1+ v_1\equivR\mu u_2+v_2$, for every scalar $\mu$. Let us first
  show the following implication
  \begin{equation}\label{equ:sum_rew}
    u_1\rewR u_2\quad\Rightarrow\quad\mu u_1+v_1\equivR\mu u_2+v_1.
  \end{equation}
  By
  definition of $\rewR$, we have $u_1=\lambda e+u$ and $u_2=\lambda v+u$,
  where $e\rewR v$ is a rewriting rule,~$\lambda$ is a scalar and $e$
  does not belong to $\supp(u)$. Let $\nu$ be the coefficient of $e$ in
  $v_1$, so that we may write $v_1=\nu e+v_1'$, where $e$ does not belong
  to $\supp(v_1')$. Since $\mu u_1+v_1=(\mu\lambda+\nu)e+\mu u+v_1'$ and
  $\mu u_2+v_1=\nu e+\mu\lambda v +\mu u+v_1'$, we have $\mu u_1+v_1
  \transR(\mu\lambda+\nu)v+\mu u+v_1'\overset{*}{\leftarrow}\mu u_2+v_1$,
  which proves~\eqref{equ:sum_rew}. If $u_1\equivR u_2$,
  using~\eqref{equ:sum_rew} and an induction on the length of the path
  $u_1\equivR u_2$ shows that $\mu u_1+v_1\equivR\mu u_2+v_1$, and by an
  analogous argument, we have $\mu u_2+v_1\equivR\mu u_2+v_2$. Hence, we
  have $\mu u_1+v_1\equivR\mu u_2+v_2$, which concludes the proof.
\end{proof}
\smallskip

In the following definition, we introduce parallel rewriting relations as
being compatible with vector space operations.
\smallskip

\begin{definition}
  A {\em parallel rewriting relation} on $V$ is a rewriting relation
  $\parRew$ on $V$ such that for every rewriting steps $u\parRew u'$ and
  $v\parRew v'$ and for every scalar $\lambda\in\K$, there exists a 
  rewriting step $u+\lambda v\parRew u'+\lambda v'$.
\end{definition}

The term parallel means that $u$ and $v$ may be reduced at once using
$\parRew$, and justify the double head arrows. Rewriting strategies that
we introduce in Definition~\ref{def:strategies} induce parallel rewriting
relations with pairwise distinct left-hand sides. The following
proposition provides a characterisation of parallel rewriting relations
with distinct left-hand sides. 
\smallskip

\begin{proposition}\label{prop:parRew_function}
  There is a one-to-one correspondance between parallel rewriting
  relations with pairwise distinct left-hand sides and functions from
  $\basis$ to $V$.
\end{proposition}

\begin{proof}
  The parallel rewriting relation with pairwise distinct left-hand sides
  $\parRew$ is associated to the function $r:\basis\to V$ defined by
  $r(e)=v$ if there is a rewriting step $e\parRew v$ with left-hand side
  $e$, and $r(e)=e$, otherwise. The map $r$ is well-defined since
  $\parRew$ has distinct left-hand sides. Conversely, any function 
  $r:\basis\to V$ induces a unique linear endomorphism of $V$, that we
  still denote by $r$. Then, the rewriting steps $v\parRew r(v)$, with
  $v\neq r(v)$, define a parallel rewriting relation with distinct
  left-hand sides. The two associations between $\parS$ and $r$ are
  inverses to each other, which concludes the proof. 
\end{proof}

Notice that if $r$ is the function corresponding to $\transParRew$, then
we have $v\transRew v'$ if and only if and there exists an integer $n$
such that $v'=r^n(v)$, where $r^n$ denotes the $n$-th composition of the
function~$r$, seen as a linear map on $V$. 
\medskip

Let us relate parallel rewriting relations to $\rewR$ using strategies.
Given a subset~$S$ of~$R$ with pairwise distinct left-hand sides, let
$\parS$ be the parallel rewriting relation that extends~$S$: based on 
Proposition~\ref{prop:parRew_function}, $\parS$ corresponds to the
function $r_S:\basis\to V$ defined by~$r_S(e)=v$ if there exists a
rewriting rule $e\rewR v$ in $S$ and $r_S(e)=e$, otherwise. Finally, we
denote by~$\ordS$ the rewriting preorder on $\basis$ induced by~$\parS$,
that is, $e\ordS e'$ if $e\in\supp(r_S(e'))$. In other words, $\ordS$ is
the transitive closure of the relation: there exists a vector $v$ such
that $e'\transParS v$ and~$e\in\supp(v)$.
\smallskip

\begin{definition}\label{def:strategies}
  A {\em pre-strategy} for $R$ is a subset $S$ of $R$ with pairwise
  distinct left-hand sides. A {\em strategy} for $R$ is a pre-strategy
  such that the rewriting preorder $\ordS$ of $\parS$ is terminating. 
\end{definition}
\smallskip

Notice that by definition of the rewriting preorder, if $S$ is a strategy
for $R$, then $\parS$ is terminating. Moreover, if the rewriting preorder
$<_R$ is terminating, then any pre-strategy is a strategy since
$e\ordS e'$ implies $e<_Re'$.
\smallskip

\begin{example}\label{ex:strategies_step_1}
  Let us illustrate (pre-)strategies with the following
  (counter)-examples.
  \begin{enumerate}
  \item\label{it:ex_strat_1} Consider the $4$-dimensional vector space
    $V$ with basis $\basis=\{e_1,e_2,e_3,e_4\}$ and let $\rewR$ be the
    rewriting relation induced by the set of rewriting rules
    \[R=\{e_1\rewR e_2,\quad e_2\rewR e_3+e_4,\quad e_3\rewR e_2-e_4\}.\]
    Notice that $\rewR$ is not terminating since
    $e_2\rewR e_3+e_4\rewR(e_2-e_4)+e_4=e_2$. Considering the
    pre-strategy
    \[S=\{e_1\rewR e_2,\quad e_2\rewR e_3+e_4\}\subset R,\]
    the preorder $\ordS$ is terminating since we have
    $e_1>_Se_2>_Se_3,e_4$. Hence, $S$ is a strategy and $\parS$ is
    terminating. Notice that any $v=\lambda_1e_1+\cdots+\lambda_4e_4$ 
    admits a unique normal form for $\parS$ that is computed as follows:
    \[v\parS\lambda_1e_2+(\lambda_2+\lambda_3)e_3+
    (\lambda_2+\lambda_4)e_4\parS(\lambda_1+\lambda_2+\lambda_3)e_3+
    (\lambda_1+\lambda_2+\lambda_4)e_4.\]
    Anticipating the discussion of the paragraph following the example,
    this unique normal form is written $\SNF(v)$:
    \[\SNF(v)=(\lambda_1+\lambda_2+\lambda_3)e_3+
    (\lambda_1+\lambda_2+\lambda_4)e_4.\]
  \item\label{it:c-ex_strat_1} Let us consider the $3$-dimensional vector
    space $V$ with basis $\basis=\{e_1,e_2,e_3\}$, let $\rewR$ induced by
    \[R=\{e_1\rewR e_2+e_3,\quad e_2\rewR e_1,\quad e_3\rewR -e_1\},\]
    and $S=R$. Then, $S$ is not a strategy since the preorder $\ordS$ is
    not terminating. In fact,~$\ordS$ is cyclic since from the rewriting
    sequence $e_2\parS e_1\parS e_2+e_3$, we get $e_2>_Se_3$, so that
    $e_1>_S e_2>_S e_3>_S e_1>_S\cdots$. Notice however that $\parS$ is
    terminating since for every
    $v=\lambda_1e_1+\lambda_2e_2+\lambda_3e_3$, we have
    \[\lambda_1e_1+\lambda_2e_2+\lambda_3e_3\parS(\lambda_2-\lambda_3)e_1
    +\lambda_1e_2+\lambda_1e_3\parS(\lambda_2-\lambda_3)e_2+(\lambda_2-
    \lambda_3)e_3\parS 0.
    \]
  \item\label{it:case_N} Let $V$ be the vector space with basis
    $\basis= \mathbb N$, and consider the set of rewriting rules
    \[R=\{n\rewR n+1:\quad n\in\N\}.\]
    Then, a pre-strategy $S$ corresponds to a subset $E$ of $\mathbb N$.
    It is a strategy if and only if for all $n \in E$, there exists
    $k \in \mathbb N$ such that $n + k \notin E$. 
  \end{enumerate}
\end{example}
\smallskip

Let $S$ be a strategy for $R$. In the sequel, we denote elements of $S$
in the form $e\parS r_S(e)$ and a normal form for $\parS$ is called an
{\em S-normal form}. We denote rewriting rules of $S$ with double head
arrows to emphasize that we will work with the parallel rewriting
relation induced by $S$ rather than the non-parallel one\footnote{In
  fact, the non parallel rewriting relation $\to_S$ is explicitly used
  twice for technical reasons: in Proposition~\ref{prop:linearity_of_SNF}
  and in the proof of Proposition~\ref{prop:S-conf_decreasing}.}. Since
$S$ is a strategy, $\parS$ is terminating and it is deterministic in the
sense that for every vector $v$, there is at most one~$v'$ such that
$v\parS v'$. Hence, each $v$ admits exactly one $S$-normal form that we
denote by~$\SNF(v)$. This defines a map $\SNF:V\to V$ whose properties
are given in the following proposition.
\smallskip

\begin{proposition}\label{prop:linearity_of_SNF}
  The map $\SNF$ is a linear projector. Moreover, for every vector $v$,
  we have~$v\transRew_S\SNF(v)$.
\end{proposition}

\begin{proof}
  Let us show the first part of the proposition. The function
  $r_S:\basis\to V$ associated to~$\parS$ induces a unique endomorphism
  of $V$, also denoted $r_S$. By definition of $\SNF$, for every  
  vector~$v$, there exists an integer $n_v$ such that
  $\SNF(v)=r_S^n(v)$, for every $n\geq n_v$. Now, let us consider a
  linear combination $v_3=v_1+\lambda v_2$ of two vectors and let $n$ be
  any integer greater than $n_{v_i}$'s. Since a composition of linear
  maps is still a linear map, we have
  $r_S^n(v_3)=r_S^n(v_1)+\lambda r_S^n(v_2)$, which proves linearity of
  $\SNF$. Let us show that $\SNF$ is a projector. A linear combination of
  $S$-normal forms is still an $S$-normal form, and for every vector $v$,
  $\SNF(v)$ is an $S$-normal form. From these two facts, for every vector
  $v$, we have $\SNF(\SNF(v))=\SNF(v)$, that is, $\SNF$ is a projector.

  Let us show by induction the second part of the proposition. If $v$ is
  an $S$-normal form, this is obvious. Otherwise, $v$ may be uniquely
  written in the form
  \begin{equation}\label{equ:decompo_max}
    v=\sum_{i=1}^n\lambda_ie_i+v'
  \end{equation}
  where the basis elements $e_i$ are the elements of $\supp(v)$ that are
  maximal for the rewriting preorder $\ordS$, $\lambda_i$ are their
  coefficients in $v$ and $v'$ is such that~\eqref{equ:decompo_max}
  holds. Since $S$ is a strategy, the preorder $\ordS$ is in fact a
  terminating order, and we assume $v'\transS\SNF(v')$ by induction. By
  definition of $<_S$, the rewriting rules of $S$ that are involved in
  this rewriting path have left-hand sides not greater than $e_i$'s, so
  that $v\transS\sum\lambda_ie_i+\SNF(v')$. Moreover, since $e_i$'s are
  not comparable for $\ordS$, for each indices $i$ and $j$, $e_i$ does
  not belong to $\supp(r_S(e_j))$. Hence, we may reduce successively each
  $e_i$ into $r_S(e_i)$ and finally have
  \[v\transS\sum\lambda_ie_i+\SNF(v')\transS\sum\lambda_ir_S(e_i)
  +\SNF(v')\transS\sum\lambda_i\SNF(e_i)+\SNF(v')
  =r_S(v).\]
  That completes the proof. \todo{Preuve plus générale}
\end{proof}

\subsection{Confluence relative to a strategy}
\label{sec:confluence_relative_to_a_strategy}

In this section, we introduce $S$-confluence for a set of rewriting rules
$R$. We show that $S$-confluence implies confluence of~$\rewR$ and
guarantees that $S$-normal forms basis elements form a basis of 
$V/\equivR$. We also show that $S$-confluence is characterised in terms
of a decreasingness property. We finish by a new proof of the diamond
lemma, based on $S$-confluence. 
\smallskip

\begin{definition}\label{def:standardisation_property}
  Given a strategy $S$ for $R$, we say that $\rewR$ is \emph{S-confluent}
  if for every rewriting rule~$e\rewR v$ in $R$, we have $\SNF(e-v)=0$.
\end{definition}
\smallskip

The following theorem illustrates how $S$-confluence is related to
confluence of $\rewR$ and the vector space $V/\equivR$.
\medskip

\begin{theorem}\label{thm:S-confluence_criterion}
  Let $R$ be a set of rewriting rules and let $S$ be a strategy for $R$.
  If the rewriting relation $\rewR$ is $S$-confluent, then it is
  confluent and we have a vector spaces isomorphism
  \begin{equation}\label{equ:iso_SNF}
    V/\equivR\quad\simeq\quad\im(\SNF).
  \end{equation}
  In particular, $\{[e]_{\equivR}:\ \SNF(e)=e\}$ is a basis of
  $V/\equivR$.
\end{theorem}

\begin{proof}
  The map $\SNF$ being a projector, the vector space $V$ has a direct sum
  decomposition $V=\ker(\SNF)\oplus\im(\SNF)$. Hence, the
  isomorphism~\eqref{equ:iso_SNF} means that $\equivR$ is the equivalence
  relation induced by $\ker(\SNF)$, that is, $v_1\equivR v_2$ if and only
  if $v_1-v_2\in\ker(\SNF)$. By Proposition~\ref{prop:linearity_of_SNF},
  we have $v_i\transS\SNF(v_i)$, so that~$\SNF(v_1-v_2)=0$ implies
  $v_1\equivR v_2$. The converse also implies confluence of $\rewR$ since
  if $v_1\equivR v_2$ is equivalent to $\SNF(v_1-v_2)=0$, the previous
  argument shows that~$\rewR$ has the Church-Rosser property. From the
  $S$-confluence hypothesis, $v_1\rewR v_2$ implies $\SNF(v_1-v_2)=0$:
  indeed, with the notations of~\eqref{equ:R_rewriting_step}, for every
  rewriting step $v_1=\lambda e+u\rewR v_2=\lambda v+u$, we have
  $\SNF(v_1-v_2)=\lambda\SNF(e-v)=0$. Since the binary relation defined
  by $\SNF(v_1-v_2)=0$ is closed under transitivity, reflexivity, and
  symmetry, it contains~$\equivR$, that is, $v_1\equivR v_2$ implies
  $v_1-v_2\in\ker(\SNF)$. Finally, since $\SNF$ is a projector, its image
  admits as a basis the set of basis elements $e$ such that $\SNF(e)=e$.
  That concludes the proof.
\end{proof}
\smallskip

Note that $S$-confluence is a sufficient but not a necessary condition for
confluence. Indeed, with $\basis$ the set of integers and the rewriting rules
$n\rewR n+1$ as in Point~\ref{it:case_N} of
Example~\ref{ex:strategies_step_1}, there is no strategy such that
$\rewR$ is confluent relative to this strategy. 
\smallskip

\begin{example}\label{ex:S-conf}
  Let us continue Point~\ref{it:ex_strat_1} of
  Example~\ref{ex:strategies_step_1}. The following identities hold:
  \[\begin{split}
  \SNF(e_1)=e_3+e_4=\SNF(e_2),&\quad\SNF(e_2)=e_3+e_4=\SNF(e_3+e_4)
  \\[0.3cm]
  \SNF(e_3)=& \ e_3=\SNF(e_2-e_4),
  \end{split}
  \smallskip\]
  so that $\rewR$ is $S$-confluent, and hence confluent. Notice that if
  we replace the rule $e_3\rewR e_2-e_4$ by $e_3\rewR e_2$, we get
  $\SNF(e_3)=e_3$ and $\SNF(e_2)=e_3+e_4$, so $\rewR$ is not
  $S$-confluent anymore. 
\end{example}
\smallskip

In Proposition~\ref{prop:S-conf_decreasing}, we show that $S$-confluence
is caracterised in terms of the decreasingness property that we introduce
in Definition~\ref{def:decreasing}. In this definition, we denote by
$\overset{=}{\twoheadrightarrow}_S$ the closure of $\parS$ under
reflexivity, that is, $v\overset{=}{\twoheadrightarrow}_Sr_S(v)$ holds 
for every vector $v$.
\smallskip

\begin{definition}\label{def:decreasing}
  Given a strategy $S$ for $R$ and a terminating order $\prec$ on $R$, we
  say that $R$ is {\em decreasing} w.r.t.\ $(S,\prec)$ if for every
  rewriting rule $e\rewR v$, we have a diagram:
  \[\begin{tikzcd}
      e\ar[d, "_R"']\ar[r, twoheadrightarrow, "=", "_S"'] &
      r_S(e)\ar[d, leftrightarrow, dotted, "*"', "_R"]\\
      v\ar[r, leftrightarrow, dotted, "*", "_R"'] & u
    \end{tikzcd}\]
  where each rewriting rule occurring in the dotted arrows is strictly
  smaller than the rewriting rule $e\rewR v$ relative to $\prec$.
\end{definition}
\smallskip

\begin{proposition}\label{prop:S-conf_decreasing}
  Let $S$ be a strategy for $R$. The following assertions are equivalent.
  \begin{enumerate}
  \item The set of rewriting rules $R$ is $S$-confluent.
  \item There exists a terminating order $\prec$ on $R$ such that $R$ is
    decreasing w.r.t.\ $(S,\prec)$.
  \end{enumerate}
\end{proposition}

\begin{proof}
  $(1)\Rightarrow (2)$: As in Proposition~\ref{prop:linearity_of_SNF}, we
  use the non parallel rewriting relation~$\to_S$ induced by $S$. We
  define the order $\prec$ on $R$ by $e\to_S r_S(e)<e'\rewR v$ whenever
  $e'\rewR v\notin S$. This order is terminating since each chain of
  strictly decreasing elements has length $2$. Let $e\rewR v$ be a
  rewriting rule and let us construct a decreasing diagram as in
  Definition~\ref{def:decreasing}. We distinguish three cases.
  \begin{itemize}
  \item If $e$ is an $S$-normal form, then we have $\SNF(e)=e$ and
    $e\rewR v$ does not belong to~$S$. Moreover, since $\rewR$ is
    $S$-confluent, we have $\SNF(e)=\SNF(v)$, and from
    Proposition~\ref{prop:linearity_of_SNF}, we get the following diagram
    \[\begin{tikzcd}
    e\ar[d, "_R"']\ar[r, equal] &
    e\ar[d, equal]\\
    v\ar[r, "*", "_S"'] & e
    \end{tikzcd}\]
    Since, by definition, $e\rewR r$ is greater than all elements of $S$ 
    for $\prec$, this diagram is decreasing w.r.t.\ $(S,\prec)$. 
  \item If $e\rewR v=e\to_S r_S(e)$ belongs to $S$, then we have the 
    following diagram:
    \[\begin{tikzcd}
    e\ar[r, twoheadrightarrow, "_S"']\ar[d, "_R"']
    & r_S(e) \ar[equal, d]\\
    r_S(e)\ar[r, equal] & r_S(e)
    \end{tikzcd}\]
    Since no rewriting step occurs in the right and bottom faces, this
    diagram is decreasing w.r.t.\ $(S,\prec)$.
  \item In the last case, $e$ is not a $S$-normal form and $e\rewR v$
    does not belong to $S$. In particular, there exists a rewriting rule
    of the form $e\parS r_S(e)=e\to_S r_S(e)$ in $S$. By definitions of
    the map $\SNF$ and of the $S$-confluence property, we have the
    equalities
    \[\SNF(r_S(e))=\SNF(e)=\SNF(v).
    \smallskip\]
    By Proposition~\ref{prop:linearity_of_SNF}, we get the following
    diagram:
    \[\begin{tikzcd}
    e\ar[d, "_R"']\ar[r, twoheadrightarrow, "_S"'] &
    r_S(e) \ar["_S", "*"', d] \\
    v \ar[r, "_S"', "*"] & \SNF (e)
    \end{tikzcd}\]
    Since $e\rewR v$ does not belong to $S$ and since every rewriting
    step in the right and bottom faces belong to $S$, they are smaller
    than $e\rewR v$ for $\prec$ by definition of this order. Hence, the
    diagram is decreasing w.r.t.\ $(S,\prec)$. 
  \end{itemize}
  $(2)\Rightarrow (1)$: Let $e\rewR v$ be a rewriting rule and let us
  assume by induction that for every rewriting step $e'\rewR v'$ smaller
  than $e\rewR v$ for $\prec$, we have $\SNF(e')=\SNF(v')$. Consider a
  decreasing diagram:
  \[\begin{tikzcd}
  e\ar[d, "_R"']\ar[r, twoheadrightarrow, "=", "_S"'] &
  r_S(e)\ar[d, leftrightarrow, dotted, "*"', "_R"]\\
  v\ar[r, leftrightarrow, dotted, "*", "_R"'] & u
  \end{tikzcd}\]
  Using our induction hypothesis and adapting the argument of the proof
  of Theorem~\ref{thm:S-confluence_criterion}, we have 
  $\SNF(v)=\SNF(u)=\SNF(r_S(e))$. Hence, since $\SNF(e)=\SNF(r_S(e))$ by
  definition of the map $\SNF$, we have $\SNF(e)=\SNF(v)$. The order
  $\prec$ being terminating, this inductive argument proves that
  $\SNF(e)=\SNF(v)$ for every rewriting rule $e\rewR v$, that is, $R$ is
  $S$-confluent.
\end{proof}
\smallskip

\begin{remark}
  In the case where the rewriting system comes from a set-theoretic rewriting
  system (that is, the right-hand sides of the rewriting rules are elements of
  the basis), the fact that local $S$-confluence implies that $\rewR$ is
  confluent is a special case of Van Ostroom's decreasing diagrams
  \cite{van2008confluence}. More precisely, based on
  Proposition~\ref{prop:S-conf_decreasing}, local $S$-confluence implies
  that the pair of rewriting relations $(\parS,\rewR)$ is decreasing with
  respect to conversions (see~\cite[Definition 3]{van2008confluence}),
  using the order $<$ on $R$ and the discrete order on $\parS$.
  By~\cite[Theorem 3]{van2008confluence}, this implies that
  $(\parS,\rewR)$ commutes. Using the fact that $\parS \subseteq \rewR$,
  one can then recover that $\rewR$ is confluent. \todo{vérifier avec
  $\transS\subseteq\transR$}
\end{remark}
\smallskip

\begin{example}\label{ex:end_to_example}
  Let us illustrate Proposition~\ref{prop:S-conf_decreasing} with
  Example~\ref{ex:S-conf}. Let us consider the following order $\prec$ on
  rewriting rules:
  \[(e_1\rewR e_2)\prec(e_3\rewR e_2-e_4),\quad(e_2\rewR e_3+e_4)\prec
  (e_3\rewR e_2-e_4).
  \smallskip\]
  This choice is guided by the heuristic that rules advancing towards an
  $S$-normal form should be favored over rules that do not: here $e_3$ is
  an $S$-normal form, so the rule that rewrites it should be larger for
  the order $\prec$. The decreasing diagrams are the following:
  \[\begin{tikzcd}
  e_1\ar[d, "_R"']\ar[r, twoheadrightarrow, "_S"'] &
  e_2\ar[d, equal] & e_2\ar[d, "_R"']
  \ar[r, twoheadrightarrow, "_S"'] & e_3+e_4\ar[d, equal] &
  e_3\ar[d, "_R"']\ar[r, twoheadrightarrow, "_S"'] & e_3\ar[d,equal]\\
  e_2\ar[r, equal] & e_2 & e_3+e_4\ar[r, equal] & e_3+e_4 & e_2-e_4
  \ar[r,  "_R"'] & e_3
  \end{tikzcd}\]
\end{example}
\smallskip

We finish this section by showing how the diamond lemma fits as a
particular case of our setup.
\medskip

\begin{theorem}[\cite{MR506890}]\label{thm:diamond_lemma}
  Let $R$ be a set of rewriting rules such that the rewriting preorder
  $<_R$ of~$\rewR$ is terminating and for every $e\in\basis$ such that
  $e\rewR v$ and $e\rewR v'$, $v$ and $v'$ are joinable. Then,~$\rewR$ is
  confluent.
\end{theorem}

\begin{proof}
  For every basis element $e$ that is reducible by $\rewR$, we select
  exactly one arbitrary rewriting rule with left hand-side
  $e$. Then, let $S$ be the pre-strategy composed of these selected
  rewriting rules. Since $<_R$ is terminating, $\ordS$ is also
  terminating, so that $S$ is a strategy for~$R$. Let us show that
  $\rewR$ is $S$-confluent using the criterion of
  Proposition~\ref{prop:S-conf_decreasing}. For that, we define the
  terminating order $\prec$ on $R$ by letting
  $(e\rewR v)\prec(e'\rewR v')$  whenever $e<_Re'$. If $e\rewR v$ is a
  rewriting rule, then $e$ is not an $R$-normal form and
  $e\overset{=}{\parS}r_S(e)$ means $e\parS r_S(e)$. Using the confluence
  hypothesis of the theorem, we have a diagram
  \[\begin{tikzcd}
  e\ar[d, "_R"']\ar[r, twoheadrightarrow, "_S"'] &
  r_S(e)\ar[d, rightarrow, "*"', "_R"]\\
  v\ar[r, rightarrow, "*", "_R"'] & u
  \end{tikzcd}\]
  Each rewriting rule appearing in the right and bottom faces is strictly
  smaller than $e\rewR r$ for~$\prec$ by definition of this rewriting
  preorder. Hence, this diagram is decreasing, so that $R$ is
  $S$-confluent. From Theorem~\ref{thm:S-confluence_criterion}, $\rewR$
  is confluent.   
\end{proof}
\smallskip

Notice that in the proof of the diamond lemma, we select for $<$ another order
than the one given in the proof of Proposition~\ref{prop:S-conf_decreasing} (the
latter asserts that each rule of $S$ is smaller than each rule which is not in
$S$ and there is no other comparison). This is a good illustration of the
flexibility of the characterisation of $S$-confluence given in
Proposition~\ref{prop:S-conf_decreasing}. 

\section{Differential elimination in rational Weyl algebras}
\label{sec:differential_elimination_in_rational_Weyl_algebras}

In this section, we investigate rewriting systems on rational Weyl
algebras and relate involutive divisions to rewriting strategies for such
systems. In particular, we show that involutive sets in rational Weyl
algebras induce confluent rewriting systems.
\medskip

Throughout the section, we fix a set $X=\{x_1,\cdots,x_n\}$ of
indeterminates and we denote by $\Q(X):=\QXX$ the field of fractions of
the polynomial algebra $\QX$ over~$\Q$, that is, the set of rational
functions in the indeterminates $X$. We fix another set of variables
$\Delta=\{\diff{1},\cdots,\diff{n}\}$ that model partial derivative
operators, see Example~\ref{ex:diff_operators_init}. We denote by
$\partial^{\alpha}:=\diff{1}^{\alpha_1}\cdots\diff{n}^{\alpha_n}$ the
monomial over $\Delta$ with multi-exponent
$\alpha=(\alpha_1,\cdots,\alpha_n)\in\N^n$. Finally, let $\monBasis$ be
the set of monomials over $\Delta$:
\[\monBasis:=\left\{\partial^\alpha:\ \alpha\in\N^n\right\}.
\smallskip\]
In what follows, we keep the terminology monomials only for elements of
$\Mon(\Delta)$ and not for elements in $\Mon(X)$.

\subsection{Rewriting systems on rational Weyl algebras}
\label{sec:rewriting_systems_on_Weyl_algebras}

In this section, we recall the definition of the rational Weyl algebra
and introduce rewriting systems on the rational Weyl algebra induced by
monic operators.
\medskip

\begin{definition}
  The {\it rational Weyl algebra} over $\Q(X)$ is the set of polynomials
  $\Q(X)[\Delta]$ with coefficients in $\Q(X)$ and indeterminates
  $\Delta$. The multiplication of this $\mathbb Q$-algebra is induced by
  the commutation laws $\partial_i\partial_j=\partial_j\partial_i$ and
  \[\diff{i}f=f\diff{i}+\frac{d}{dx_i}(f),\quad f\in\Q(X),\quad
  1\leq i\leq n,
  \smallskip\]
  where $d/dx_i:\Q(X)\to\Q(X)$ is the partial derivative operator with
  respect to~$x_i$. This algebra is denoted by $\Weyl{n}$.
\end{definition}
\smallskip

Notice that $\Weyl{n}$ is a $\Q(X)$-vector space and that the monomial 
set $\monBasis$ is a basis of~$\Weyl{n}$. Elements of~$\Weyl{n}$ should 
be thought of as differential operators with rational functions 
coefficients and for this reason, a generic element of this algebra is
denoted by $\D$ and is called a differential operator. In the following
example, we illustrate how these operators provide an algebraic model of
linear systems of ordinary differential (in the case $n=1$) and partial
derivative equations (in the case $n\geq 2$) with one unknown function. 
\smallskip

\begin{example}\label{ex:diff_operators_init}
  {\color{white}toto}
  \begin{enumerate}
  \item\label{it:ODE_init} The linear ordinary differential equation
    $y'(x)=xy(x)$ is written in the form $(\D y)(x)=0$, where the operator
    $\D:=\partial-x$ belongs to $\Weyl{1}=\Q(x)[\partial]$. 
  \item\label{it:Janet_example_init} Consider Janet's
    example~\cite{MR1308976}, that is, the linear system of partial
    derivative equations with~$3$ variables, one unknown function, and
    the two equations $y_{33}(x)=x_2y_{11}(x)$ and $y_{22}(x)=0$, where
    $y_{ij}(x)$ denotes the second order derivative of the unknown
    function $y(x)$ with respect to the variables $x_i$ and~$x_j$. Then,
    these equations are written $(\D_1y)(x)=0$ and $(\D_2y)(x)=0$, where
    $\D_1,\D_2\in\Weyl{3}$ are defined as follows:
    \[\D_1:=\partial_3^2-x_2\partial_1^2,\quad \D_2:=\partial_2^2.
    \smallskip\]
  \end{enumerate}
\end{example}

\begin{remark}
  In~\ref{it:ODE_init} of Example~\ref{ex:diff_operators_init}, we
  implicitly used that every $f\in\Q(X)$ induces a unique multiplication
  operator $y(x)\mapsto f(x)y(x)$.
\end{remark}
\smallskip

The next step before introducing rewriting systems on rational Weyl
algebras is to recall the definition of monic operators. We fix a
monomial order $\prec$ on $\monBasis$, that is, a terminating total 
order which is admissible, \ie, $\partial^{\alpha}\prec\partial^{\beta}$
implies $\partial^{\alpha+\gamma}\prec\partial^{\beta+\gamma}$, for every
$\alpha,\beta,\gamma\in\N^n$. Given an operator $\D$, we denote by
$\lm(\D)$ the leading monomial of $\D$ with respect to~$\prec$, that 
is, $\lm(\D)$ is the greatest element of $\supp(\D)$, where the support 
is defined w.r.t.\ the basis $\monBasis$. 
\smallskip

\begin{definition}
  Let $\prec$ be a monomial order on $\monBasis$. A differential
  operator $\D\in\Weyl{n}$ is said to be $\prec$-{\em monic} if the
  coefficient of $\lm(\D)$ on $\D$ is equal to $1$. Moreover, given a
  monic differential operator $\D$, we denote by $r(\D):=\lm(\D)-\D$.
\end{definition}
\smallskip

Since the monomial order $\prec$ is fixed, me simply say monic instead of
$\prec$-monic. Given a set~$\Theta\subseteq\Weyl{n}$ of monic operators,
let us consider the rewriting relation on $\Weyl{n}$ induced by the
following rewriting rules: 
\begin{equation}\label{equ:rewTheta}
  \RTheta:=\Big\{\partial^\alpha\lm(\D)\to_{\RTheta}\partial^\alpha
  r(\D):\ \D\in\Theta,\ \partial^\alpha\in\Mon(\Delta)\Big\}.
\end{equation}
For simplicity, we write $\D\rewTheta\D'$ instead of
$\D\to_{R_\Theta}\D'$. The rewriting relation $\rewTheta$ is terminating
since the rewriting rules reduce a monomial into a combination of
strictly smaller monomials w.r.t.\ the terminating order $\prec$.
Moreover, notice that in the case where the coefficient $\lc(\D)\in\Q(X)$
of $\lm(\D)$ in $\D$ is not constant, the situation is much harder.
Indeed, in this case, the left-hand sides of the rewriting rules are of
the form $\partial^\alpha(\lc(\D)\lm(\D))$ and due to commutation laws,
these elements are not monomials. In particular, we are not in the
situation of our general approach developed in  
Section~\ref{sec:a_weak_version_of_the_diamond_lemma} anymore.
\medskip

We finish this section with some comments on $\rewTheta$. Let us consider 
the linear system of ordinary differential or partial derivative
equations with unknown function $y$ given by 
\begin{equation}\label{equ:PDE_system}
  \{(\D y)=0:\D\in\Theta\}.
\end{equation}
Let $y(x)$ be an arbitrary solution to this system. Then, for every
operator $\partial^\alpha$ and every $\D\in\Theta$, we also have
$(\partial^\alpha\D y)(x)=0$, or equivalently,
$(\partial^\alpha\lm(\D)y)(x)=(\partial^\alpha r(\D)y)(x)$. Hence, if
there is a rewriting path $\D_1\transTheta\D_2$, then the solution $y(x)$
of~\eqref{equ:PDE_system} satisfies $(\D_1y)(x)=(\D_2y)(x)$. This remark
has deep applications in the formal theory of partial differential
equations, for instance for finding integrability conditions or computing
dimensions of solution spaces, see~\cite{MR1308976}. Moreover, notice
that since $\monBasis$ is a commutative set, there is another possible
choice for rewriting the monomial $\partial^\alpha\lm(\D)$
in~\eqref{equ:rewTheta}. Indeed, we could swap $\partial^\alpha$ and
$\lm(\D)$ to get the new rule
$\lm(\D)\partial^\alpha\rewTheta r(\D)\partial^\alpha$. This rule is
simpler in the sense that it does not require to apply any commutation 
law to its right-hand side in contrast with~\eqref{equ:rewTheta}.
However, we do not take this rule into account since it would break the
algebraic model of partial derivative equations. Indeed, if $y(x)$ is a
solution of~\eqref{equ:PDE_system}, then the relation
$(\lm(\D_i)\partial^\alpha y)(x)=(r(\D_i)\partial^\alpha y)(x)$ does not
hold in general, as illustrated in~\ref{it:ODE_rew} of the following
example.
\smallskip

\begin{example}\label{ex:diff_operators_rew}
  We continue Example~\ref{ex:diff_operators_init}.
  \begin{enumerate}
  \item\label{it:ODE_rew} Let $\Theta:=\{\D\}$ where
    $\D:=\partial-x\in\Weyl{1}$. Since $\partial$ is greater than $1$ for
    every monomial order, $\rewTheta$ is induced by the rewriting rules
    $\partial^n\rewTheta \partial^{n-1}x$, where $n$ is a strictly
    positive integer. In particular, we have the following rewriting
    sequence:
    \[\partial^2\rewTheta\partial x=x\partial+1\rewTheta x^2+1.
    \smallskip\]
    In terms of the corresponding differential equation $y'(x)=xy(x)$,
    this rewriting sequence has the following meaning. First, notice that
    the space of solutions of this equation is the one-dimensional
    $\R$-vector space spanned by the function $e^{x^2/2}$. The second
    order derivative of a solution $y(x)=Ce^{x^2/2}$, for an arbitrary
    constant $C$, is given by the formula $y''(x)=(x^2+1)Ce^{x^2/2}$,
    which reads $(\partial^2y)(x)=(x^2+1)y(x)$ in terms of operators.
    Notice that if we allow to reduce the left $\partial$ in
    $\partial^2$, then we get $\partial^2\transTheta x^2$, which is false
    in terms of operators since $y''(x)$ is not equal to $x^2y(x)$.
  \item\label{it:Janet_example_rew} Let $\Theta:=\{\D_1,\D_2\}$, where
    $\D_1:=\partial_3^2-x_2\partial_1^2$ and $\D_2:=\partial_2^2$
    correspond to the two equations of the Janet example. We define
    $\prec$ as being the deg-lex order on
    $\Mon(\partial_1,\partial_2,\partial_3)$ induced by
    $\partial_1\prec\partial_2\prec\partial_3$, so that $\rewTheta$ is
    induced by the rewriting rules
    $\partial_3^2\rewTheta x_2\partial_1^2$ and
    $\partial_2^2\rewTheta 0$. Then, $\rewTheta$ is not confluent since:
    \begin{equation}\label{equ:non_conf_Janet_ex}
      \begin{tikzcd}
        \partial_2^2\partial_3^2\ar[d, "_\Theta"']\ar[r, "_\Theta"'] &
        \partial_2^2(x_2\partial_1^2)\ar[d, "_\Theta"]\\
        0 & 2\partial_1^2\partial_2
      \end{tikzcd}
    \end{equation}
    The right arrow is an application of the rule
    $\partial_2^2 \rewTheta 0$, made possible since
    $\partial_2^2(x_2\partial_1^2)$ is equal to
    $\partial_1^2\partial_2+x_2\partial_1^2\partial_2^2$ (to see this, it
    suffices to apply twice the commutation law
    $\partial_2x_2=x_2\partial_2+1$).  We deduce
    from~\eqref{equ:non_conf_Janet_ex} that any solution $y(x)$ of the
    equations $(\D_iy)(x)=0$ has to verify the new integrability
    condition $y_{112}(x)=0$.
  \end{enumerate}
\end{example}
\smallskip

\subsection{Involutive divisions and strategies}
\label{sec:involutive_divisions_ and_strategies}

In this section, we interpret involutive divisions in terms of strategies
for the rewriting relation induced by a set of monic differential
operators. From this, we show that the rewriting system induced by an
involutive set of operators is confluent.
\medskip

We first recall from~\cite{MR1627129} the definition of involutive
divisions and associated notions that are involutive divisors,
multiplicative variables, and autoreducibility. For that, we temporally
work with monomials instead of operators and denote these monomials with
Latin letters $u,m$ instead of~$\partial^\alpha$. Then, we will reuse the
operator notation for monomials when we will consider rewriting systems
on rational Weyl algebras. An {\em involutive division} $L$ on
$\Mon(\Delta)$ is defined by a binary relation $\divInv{L}^U$ on
$U\times\Mon(\Delta)$, for every finite subset $U\subset\Mon(\Delta)$,
satisfying for every $u,u'\in U$ and every $m,m'\in\Mon(\Delta)$, the
following relations:
\begin{enumerate}[label=\alph*)]
\item\label{it:div} $u\divInv{L}^Um\Rightarrow u\mid m$,
\item\label{it:unit} $u\divInv{L}^Uu$,
\item\label{it:mul} $u\divInv{L}^Uum$ and $u\divInv{L}^Uum'$ if and only
  if $u\divInv{L}^Uumm'$,
\item\label{it:vertex} $u\divInv{L}^Um$ and $u'\divInv{L}^Um$ implies
  $u\divInv{L}^Uu'$ or $u'\divInv{L}^Uu$,
\item\label{it:transitivity} $u\divInv{L}^Uu'$ and $u'\divInv{L}^Um$
  implies $u\divInv{L}^Um$,
\item\label{it:filter} for every $V\subseteq U$ and every $v\in V$,
  $v\divInv{L}^Um$ implies $v\divInv{L}^Vm$. 
\end{enumerate}
In the sequel, we write $\divInv{L}$ instead if $\divInv{L}^U$ when the
context is clear. We say that $u\in U$ is an {\em L-involutive divisor}
of a monomial $m$ if $u\divInv{L}m$. The variable~$\partial_i$ is said to be
{\em L-multiplicative} for $u$ w.r.t.\ $U$ if $u$ is an $L$-involutive
divisor of $\partial_iu$. Notice that $u\divInv{L}m$ if and only if
$m=m'u$, where $m'$ contains only $L$-multiplicative variables for $u$
w.r.t.\ $U$. Notice also that an involutive division is entirely
determined by the list of multiplicative variables w.r.t.\ each finite
set $U$ such that conditions \ref{it:vertex}, \ref{it:transitivity}, and
\ref{it:filter} are fulfilled. We say that $U$ is {\em L-autoreduced} if
every $u\in U$ admits only $u$ as $L$-involutive divisor, \ie,
$u'\divInv{L}u$ implies $u'=u$. Notice that if $U$ is $L$-autoreduced,
then every monomial $m$ admits at most one $L$-involutive divisor. We
finish this discussion on involutive divisions with three classical
examples. Before, let us introduce the following notation: given a
monomial $m=\partial^\alpha\in\monBasis$, let us denote by
$d_k(m):=\alpha_k$ the degree of $m$ w.r.t. the variable $\partial_k$.
\smallskip

\begin{example}\label{ex:involutive_division}

  We fix a finite set of monomials $U\subset\monBasis$. The
  {\em Janet, Thomas} and {\em Pommaret} divisions are the involutive
  divisions $\divInv{J},\divInv{T}$, and $\divInv{P}$ such that the
  variable $\partial_i$, where $1\leq i\leq n$, is
  $J,L$ or $P$-multiplicative for $u$ w.r.t.\ $U$ if and only if 
  \begin{itemize}
  \item for $\divInv{J}$: $d_i(u)=\max\{d_i(u'):\ u'\in U\ \text{and}\
    d_j(u')=d_j(u),\ \forall i<j\leq n\}$, 
  \item for $\divInv{T}$: $d_i(u)=\max\{d_i(u'):\ u'\in U\}$,
  \item for $\divInv{P}$: for every $1\leq j\leq i$, we have $d_j(u)=0$.
  \end{itemize}

  
\end{example}
\smallskip

Now, we return to differential operators and we fix a monomial order
$\prec$ on $\monBasis$. Given a finite set $\Theta\subset\Weyl{n}$ of
$\prec$-monic differential operators, all the theory of monomial sets can
be applied to the case where $U$ is the set of leading monomials of
elements of $\Theta$:
\[\lm(\Theta):=\left\{\lm(\D):\ \D\in\Theta\right\}\subset\monBasis
\smallskip\]
Hence, we may extend the autoreducibility property for monomial sets
w.r.t.\ an involutive division to sets of differential operators.
\smallskip

\begin{definition}
  Let $\Theta\subset\Weyl{n}$ be a finite set of $\prec$-monic
  differential operators, let $\prec$ be a monomial order, and let $L$ be
  an involutive division on $\Mon(\Delta)$. We say that $\Theta$ is
  {\em left L-autoreduced} if $\lm(\Theta)$ is $L$-autoreduced.
\end{definition}
\smallskip
\noindent
The adjective "left" is here to emphasis that it may exist
$\D,\D'\in\Theta$ such that $\lm(\D)$ is an $L$-involutive divisor of a
monomial $\partial^\alpha\in\supp(r(\D'))$.
\medskip

\begin{example}\label{ex:multiplicative_variables}
  We can now apply the involutive divisions of 
  Example~\ref{ex:involutive_division} to find the multiplicative
  variables associated to the differential operators of
  Example~\ref{ex:diff_operators_rew}.
  \begin{enumerate}
  \item Take $\Theta = \{\D\}$, where $\D = \partial - x \in \Weyl 1$.
    Then, $\lm(\D) =\partial$, and $\partial$ is a multiplicative
    variable for $\D$ for the Janet and Thomas divisions, but not for the
    Pommaret one. This means that $\partial \divInv{J}^\Theta \partial^n$
    and $\partial \divInv{T}^\Theta \partial^n$ for all $n > 0$, but that
    $\partial \nmid_P^\Theta \partial^n$, unless $n = 1$. In addition,
    since $\Theta$ is a singleton, it is trivially left-autoreduced for
    all three involutive divisions. 
  \item Take now $\Theta = \{\D_1,\D_2\}$, where
    $\D_1=\partial_3^2 - x_2\partial_1^2$ and $\D_2 = \partial_2^2$. The
    following table gives the multiplicative variables for $\D_1$ and
    $\D_2$ w.r.t.\ $\Theta$ for all three involutive divisions:
    \begin{center}
    \begin{tabular}{l|ccc}
      & Janet & Thomas & Pommaret \\ \hline
      $\D_1$ & $\partial_1, \partial_2, \partial_3$ & $\partial_1, \partial_3$ & $\emptyset$ \\
      $\D_2$ & $\partial_1, \partial_2$ & $\partial_2$ & $\partial_1$ \\
    \end{tabular}
  \end{center}
    Once again, the leading monomials of elements of $\Theta$ do not divide
    each others, so $\Theta$ is left-autoreduced for all three involutive
    divisions.
  \end{enumerate}
\end{example}
\smallskip


From now on, we fix a set $\Theta$ of monic (the order being fixed, we
drop it in $\prec$-monic) differential operators. Let $\RTheta$  be the
set of rewriting rules of the form
$\partial^\alpha\lm(\D)\rewTheta\partial^\alpha r(\D)$, such as
in~\eqref{equ:rewTheta}. Since $\lm(\Theta)$ is the only monomial set we
will work with, we omit it in the symbol of the involutive division: we
write $\lm(\D)\divInv{L}\partial^\alpha\lm(\D)$ when $\partial^\alpha$
contains only $L$-multiplicative variables for $\lm(\D)$ w.r.t.\
$\lm(\Theta)$. Finally, we let
\begin{equation}\label{equ:S-strategy}
  \SThetaL:=\Big\{\partial^\alpha\lm(\D)\parTheta{L}\partial^\alpha
  r(\D) : \, \D\in\Theta,\quad\lm(\D)\divInv{L}\partial^\alpha\lm(\D)
  \Big\}.
  \smallskip
\end{equation}
Here again, we choose to write
$\partial^\alpha\lm(\D)\parTheta{L}\partial^\alpha r(\D)$ instead of
$\partial^\alpha\lm(\D)\twoheadrightarrow_{\SThetaL}\partial^\alpha
r(\D_i)$ in order to simplify notations.
\smallskip

\begin{proposition}\label{prop:involutive_strategy}
  Let L be an involutive division on $\Mon(\Delta)$ such that $\Theta$ is
  left L-autoreduced. Then $\SThetaL$ is a strategy for $\RTheta$.  
\end{proposition}

\begin{proof}
  If the set $\Theta$ is left $L$-autoreduced, then every monomial admits
  at most one $L$-involutive divisor. Moreover, every left-hand side
  $\partial^\alpha\lm(\D)$ of a rewriting rule of $\SThetaL$ is
  $L$-divisible by~$\lm(\D)$. Hence, left-hand sides of $\SThetaL$ are
  pairwise distinct, which means that $\SThetaL$ is a pre-strategy for
  $\RTheta$. Finally, if $<_\Theta$ denotes the rewriting preorder of
  $\rewTheta$, then $\partial^\alpha<_\Theta\partial^\beta$ implies that
  $\partial^\alpha\prec\partial^\beta$, so that $<_\Theta$ is
  terminating. Hence, the rewriting preorder of $\twoheadrightarrow_{\SThetaL}$ is also
  terminating, and $\SThetaL$ is a strategy for $\RTheta$.
\end{proof}
\smallskip


From Proposition~\ref{prop:involutive_strategy}, any involutive division
$L$ such that $\Theta$ is left $L$-autoreduced induces a strategy
$\SThetaL$ for $\RTheta$. Hence, we get a well-defined normalisation
operator $\SThetaLNF$ corresponding to this strategy. The following
definition is an adaptation of the notion of involutive bases for
polynomial ideals~\cite{MR1627129} to the case of sets of monic
differential operators.
\smallskip

\begin{definition}
  Let $\Theta\subset\Weyl{n}$ be a finite set of differential operators,
  let $\prec$ be a monomial order on $\monBasis$ such that each element
  of $\Theta$ is monic, and let $L$ be an involutive division on
  $\Mon(\Delta)$ such that $\Theta$ is left $L$-autoreduced. We say that
  $\Theta$ is {\em $L$-involutive} if for every $\D\in\Theta$ and every
  $\partial^\alpha\in\Mon(\Delta)$, we have
  $\SThetaLNF(\partial^\alpha\D)=0$. 
\end{definition}
\smallskip

\begin{example}
Let us continue Example~\ref{ex:multiplicative_variables}.
\begin{enumerate}
\item In the case $\Theta = \{ \D \}$, with $\D = \partial - x$. For the
  Pommaret division, we have seen that $\D$ admits no multiplicative
  variable, so the strategy $S_{\Theta,P}$ is reduced to the rule
  $\partial\parTheta{P} x$. As a result we get:
  \[\partial \D = \partial^2 - \partial x = \partial^2 - x \partial - 1
  \parTheta{P} \partial^2 - x^2 - 1.
  \]
  This last term is a normal form for $\parTheta{P}$, hence
  $\SThetaNF{P}(\partial\D) \neq 0$ and so $\Theta$ is not
  $P$-involutive. On the other hand for the Janet and Thomas divisions,
  $S_{\Theta,J}$ and $S_{\Theta,T}$ coincide, and contain the rules
  $\partial^{n+1}\parTheta{L}\partial^n x$, where $L=J,T$. This yields:
  \[
  \partial\D=\partial^2-\partial x=\partial^2-x\partial-1\parTheta{L}
  \partial x-x^2-1=x\partial -x^2 \parTheta{L}0.
  \]
  So we get $\SThetaNF{L}(\partial\D) = 0$, and more generally
  $\SThetaNF{L}(\partial^n\D) = 0$: $\Theta$ is both  $J$- and
  $T$-involutive.  
\item In the case $\Theta = \{ \D_1 , \D_2 \}$, with
  $\D_1 = \partial_3^2 - x_2 \partial_1^2$ and $\D_2 = \partial_2^2$,
  $\Theta$ will not be involutive for either of the three involutive
  divisions of Example~\ref{ex:involutive_division}. In the case of the
  Janet division for example, we have:
  \[
    \partial_3^2 \D_2 = \partial_2^2 \partial_3^2
    \parTheta{J} \partial_2^2 (x_2 \partial_1^2) =
    x_2 \partial_1^2 \partial_2^2 - 2 \partial_1^2 \partial_2
    \parTheta{J} 2 \partial_1^2 \partial_2.
  \]
  This last term is a normal form for $S_{\Theta,J}$, so we get
  $\SThetaNF{J}(\partial_3^2 \D_2) = 2 \partial_1^2 \partial_2
  \neq 0$: $\Theta$ is not $J$-involutive. 
\end{enumerate}
\end{example}

The astute reader may remark that the last computation of the previous
example is closely related to the diagram appearing in 
Example~\ref{ex:diff_operators_rew}, which shows that $\rewTheta$ fails
to be confluent. This relationship between confluence and
$L$-involutivity is actually a very general one, as shown by the
following theorem.
\medskip

\begin{theorem}
  Let $\Theta\subset\Weyl{n}$ be a finite set of differential operators,
  let $\prec$ be a monomial order on $\monBasis$ such that each element
  of $\Theta$ is monic, and let L be an involutive division 
  on~$\monBasis$ such that $\Theta$ is left L-autoreduced. If $\Theta$ is
  L-involutive, then the rewriting relation~$\rewTheta$ is confluent.
\end{theorem}

\begin{proof}
  Let $\SThetaL$ be the strategy for $\RTheta$ defined such as
  in~\eqref{equ:S-strategy}. Since rewriting rules of $\RTheta$ are of
  the form $\partial^\alpha\lm(\D)\rewTheta\partial^\alpha R(\D)$, where
  $\D\in\Theta$ and $\partial^\alpha\in\monBasis$, the assumption that
  $\Theta$ is $L$-involutive means that $\rewTheta$ is
  $\SThetaL$-confluent. By Theorem~\ref{thm:S-confluence_criterion},
  $\rewTheta$ is confluent.
\end{proof}
\smallskip

\begin{remark}
  As for term rewriting systems or \G\ bases theory, there exists a
  completion procedure in the situation of differential operators, which
  corresponds to Knuth-Bendix or Buchberger procedures. In the case of 
  the Janet example, it turns out that after a finite number of steps,
  this procedure yields the the following involutive set,
  see~\cite{MR1308976}:
  \[\overline{\Theta}=\left\{\D_1,\quad\D_2,\quad\partial_1^2\partial_2,
  \quad\partial_2^2\partial_3,\quad\partial_1^4,\quad\partial_1^2
  \partial_2\partial_3,\quad\partial_1^4\partial_3\right\}.\]
\end{remark}
\medskip

The end of this section aims to show that
axioms~\ref{it:div}--\ref{it:transitivity} in the definition of an
involutive division may be formulated in a purely rewriting language
using strategies. We fix a strategy~$S$ for $\rewTheta$. For every
$\D\in\Theta$, we say that $\lm(\D)$ {\em S-divides} the monomial
$\partial^\alpha\in\monBasis$ if $S$ contains a rewriting rule of the
form $\partial^\alpha\lm(\D)\parS\partial^\alpha r(\D)$ and we say that
the variable $\partial_i\in\Delta$ is {\em S-multiplicative} for $\D$ if
$\partial_i\lm(\D)$ is $S$-divisible by $\lm(\D)$. 
\smallskip

\begin{definition}
  A strategy $S$ for $\RTheta$ is said to be {\em involutive} if for
  every left-hand side $\partial^\alpha\lm(\D)$ of a rewriting rule in
  $S$, then $\partial^\alpha$ contains only $S$-multiplicative variables
  of $\D$.
\end{definition}
\smallskip

\begin{proposition}
  If the strategy $S$ is involutive, then the S-division satisfies
  axioms~\ref{it:div}--\ref{it:transitivity} of the definition of an
  involutive division. Moreover, if L is an involutive division on
  $\monBasis$ such that $\Theta$ is left L-autoreduced, then the
  $\SThetaL$-division is the restriction of L to $\lm(\Theta)$.
\end{proposition}

\begin{proof}
  Let us show the first assertion. Axioms~\ref{it:div}, \ref{it:vertex},
  and~\ref{it:transitivity} hold since $S$ is a strategy for $\RTheta$.
  Indeed, left-hand sides of $\RTheta$ are of the form
  $\partial^\alpha\lm(\D)$, hence~\ref{it:div}, and left-hand sides of
  elements of $S$ are pairwise distinct, hence~\ref{it:vertex}
  and~\ref{it:transitivity}. Moreover, axioms~\ref{it:unit}
  and~\ref{it:mul} hold by definition of an involutive strategy.

  Let us show the second assertion. By definition of the strategy
  $\SThetaL$ and of the $\SThetaL$-division, $\lm(\D)$ has the same set
  of multiplicative variables for $L$ and for the $\SThetaL$-division.
  Hence, a monomial $\partial^\alpha$ is $L$-divisible by $\lm(\D)$, with
  $\D\in\Theta$, if and only if it is $\SThetaL$-divisible by $\lm(\D)$.
  That proves the assertion.
\end{proof}

\section{Conclusion}

We introduced a sufficient condition,
based on deterministic reduction strategies, of confluence for
rewriting systems on vector spaces. As a particular case,
we recover the diamond lemma. This work maybe extended in particular
into two main directions. The first one consists in weakening our assumption
on the set $\K$ of coefficients, by allowing non invertible coefficients.
A second extension consists in characterising Janet bases in this framework,
with the objective to develop constructive methods in the analysis and formal
resolution of PDE's.

\bibliography{Biblio}

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
