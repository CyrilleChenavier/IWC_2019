\documentclass[10pt]{easychair}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb,mathrsfs}
\pagestyle{plain}
\usepackage{enumitem} 
\usepackage{amsthm}
\usepackage{titlesec}
\usepackage[all]{xy}
\usepackage{algorithm}
\usepackage{algorithmic}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{property}[theorem]{Property}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}


\newcommand\K{\mathbb{K}}
\newcommand\KX{\K X}
\newcommand\supp{\text{supp}}
\newcommand\Span[1]{\langle#1\rangle}
\newcommand\rewR{\underset{R}{\longrightarrow}}
\newcommand\rewh{\underset{h}{\longrightarrow}}
\newcommand\transR{\overset{*}{\rewR}}
\newcommand\transh{\overset{*}{\rewh}}
\newcommand\equivR{\underset{R}{\overset{*}{\longleftrightarrow}}}
\newcommand\equivh{\underset{h}{\overset{*}{\longleftrightarrow}}}
\newcommand\G{Gr√∂bner}

\bibliographystyle{plain}

\newcommand\todo[1]{{\bf\textcolor{red}{#1.}}}

\begin{document}

\title{The Diamond Lemma for non-terminating rewriting systems using deterministic reduction strategies (Long Version)}

\author{
Cyrille Chenavier\inst{1}
\and
Maxime Lucas\inst{2}
}

\institute{
  Inria Lille - Nord Europe, \'Equipe Valse\\
  \email{cyrille.chenavier@inria.fr}
\and
Inria Rennes - Bretagne Atlantique, \'Equipe Gallinette\\
\email{maxime.lucas@inria.fr}
}

\authorrunning{Chenavier and Lucas}
\titlerunning{Running title}

\maketitle

\begin{abstract}
  We study the confluence property for rewriting systems whose underlying set of terms admits a vector space structure. For that, we use deterministic reduction strategies.
  These strategies are based on the choice of standard reductions applied to basis elements.
  We provide a sufficient condition of confluence in terms of the kernel of the operator which computes standard normal forms.
  We present a local criterion which enables us to check the confluence property in this framework.
  We show how this criterion is related to the Diamond Lemma for terminating rewriting systems.
\end{abstract}

\todo{plan:
  \begin{itemize}
  \item Section I: IWC theorem
  \item Section 2: rew on rationnal Weyl algebras
    \begin{itemize}
    \item definition of rew. rules and rew. steps
    \item proposition: convergent implies general form of solution to PDE
    \item Janet bases: Janet complete implies existence of a strategy, passivity implies $h$-confluence criterion, as a consequence we recover formal solutions to PDE
    \item $y'=xy$ and Janet example
    \end{itemize}
  \end{itemize}
  Example $y'=xy$, main steps:
  \begin{itemize}
  \item general solution is given by $\Span{u\mid x^{2n+1}}=0$ and $\Span{u\mid x^{2n}}=u(0)/(2^nn!)$
  \item we recover this by rew: we need $(\partial_x)^nx=x(\partial_x)^n+n(\partial_x)^{n-1}$ (using Leibniz identity and induction) and $\Span{u\mid x^n}=1/(n!)(\partial_x)^n(u)_{\mid 0}$ and we prove the previous two formulas by induction (use this example as a running example?)
  \end{itemize}
}

\section{Introduction}

The fact that local confluence together with termination implies
confluence has been known for abstract rewriting systems since
Newman's work~\cite{MR0007372}. For rewriting on noncommutative
polynomials, a similar result known as the Diamond lemma was
introduced by Bergman~\cite{MR506890} nearly 30 years later, in order
to compute normal forms in noncommutative algebras using rewriting
theory. It asserts that for terminating rewriting systems, the local
confluence property can be checked on monomials.

One difficulty of rewriting polynomials is that the naive notion of
rewriting path (obtained as the closure of the generating rewriting
relations under reflexivity, transitivity, sum and product by a
scalar) does not terminate. Instead, one needs to first consider
well-formed rewriting steps before forming the reflexive transitive
closure.

Nevertheless the Diamond lemma has proved to be very useful : together
with the works of Bokut~\cite{MR0506423}, it has given birth the
theory of noncommutative \G\ bases~\cite{MR1299371}. The latter have
provided applications to various areas of noncommutative algebra such
as the study of embedding problems (which appear in the works of Bokut
and Bergman), homological algebra~\cite{MR1072284, MR2110434} or
Koszul duality~\cite{MR1832913, MR0265437}.

Computation of normal forms in noncommutative algebra is also used to
provide formal solutions to partial differential equations. In this
framework, a confluence criterion analogous to the Diamond Lemma is
given by Janet bases~\cite{MR2394773}, which specify a deterministic
way to reduce each polynomial into normal form using standard
reductions~\cite{Mell}. The confluence criterion may then be asserted
as follows: for each monomial $m$ and each non-standard reduction
$m\to f$, $f$ is reducible into $\widehat{m}$, where the latter is
obtained from $m$ using only standard reductions.

In the presented paper, we propose an extension of the Diamond Lemma
which offers two improvements over the one from Bergman: first it
allows the treatment of non-terminating rewriting relations, and
second it does not presuppose a notion of well-formed rewriting
steps. This last property seems particularly promising in order to
extend the Diamond Lemma to other structures.

Instead of supposing that the rewriting relation studied is
terminating, we suppose given an ordering on the monomials,
independent of the rewriting relation.  We then use methods based on
standard reductions: for every monomial $m$, we select exactly one
reduction with left-hand side $m$, which is decreasing for the
ordering chosen. Such choices induce a deterministic way to reduce
each polynomial, obtained by applying simultaneously standard
reductions on every monomial appearing in its decomposition. When
these deterministic reductions terminate, one defines an operator
which maps every polynomial to its unique standard normal form.

From this operator, we define a suitable notion of confluence in
our setting, and show in Proposition~\ref{prop:h-conf_implies_conf}
that it implies the usual notion of confluence for the rewriting
system studied. We then provide an effective method for checking this
criterion in Theorem~\ref{thm:confluence_criterion}. This method is
based on a local analysis corresponding to checking local confluence
on monomials. In particular, when the rewriting system is terminating,
we show (Theorem~\ref{thm:diamond_lemma}) that we recover the Diamond
Lemma as a particular case of Theorem~\ref{thm:confluence_criterion}.

\section{Local strategies and $h$-normal forms}

We fix a commutative field $\K$ as well as a well-founded partially ordered set
$(X,<_X)$. We denote by $\KX$ the vector space spanned by~$X$: an element
$v\in\KX$ is a finite formal linear combination of elements of $X$ with
coefficients in $\K$.  The sum of
$u=\sum\lambda_xx$ and $v=\sum\mu_xx$ equals $\sum(\lambda_x+\mu_x)x$ and
the product of $\lambda\in\K$ by $v$ equals $\sum(\lambda\lambda_x)x$.
For every $v\in\KX$, there exists a
unique finite set $\supp(v)\subset X$, called the \emph{support} of $v$,
such that
\begin{small}
  \begin{equation}\label{equ:support}
    v=\sum_{x\in\supp(v)}\lambda_xx\ \text{and}\ x\in\supp(v)\Rightarrow\lambda_x
    \neq 0.
  \end{equation}
\end{small}
\smallskip
\noindent
We
extend the order $<_X$ into the multiset order on $\KX$, denoted $<_{\KX}$:
for any $u,v \in \KX$, $u<_{\KX}v$ if $\supp(u) \neq \supp(v)$ and for any $x\in\supp(u)\setminus\supp(v)$, there
exists $y\in\supp(v)\setminus\supp(u)$ such that $y>_Xx$. Note that $<_{\KX}$ and $<_X$ coincide when restricted to $X$,
so we simply denote this order by $<$ in the rest of this paper.

\medskip

We fix a set $R\subseteq X\times\KX$ which represents rewrite rules of
the form $x\rewR r$. The set $R$ induces a rewriting relation on $\KX$ which reduces many $x$'s at once and defined as follows:
\begin{small}
  \begin{equation}\label{equ:rewriting_step}
    \sum_x\lambda_xx+v\rewR\sum_x\lambda_xr_x+v,
  \end{equation}
\end{small}
where $v$ is any element of $\KX$, and for any $x \in X$ appearing in the sum,  $\lambda_x\neq 0$, $x\rewR r_x\in R$ and $x\notin\supp(v)$.
Finally we denote by $\equivR$ the closure of $\rewR$ under transitivity, symmetry and sum.

\begin{definition}
  A \emph{local strategy} $h$ for $R$ is the choice, for every $x \in X$ not minimal for $<$, of a rewriting rule $h_x=x \rewR r_x$ such that $r_x < x$. 
\end{definition}

In the rest of this paper, we suppose chosen such a local strategy $h$ (note that such an $h$ may not exist). 
Any vector $v$ can be decomposed in a unique way as
$\sum\lambda_xx+v'$, where $y\in\supp(v')$ implies that $y$ is minimal
for $<$, and $x\in\supp(v)\setminus\supp(v')$ is not. We define a rewriting
relation $\rewh$ as follows:
\begin{small}
  \begin{equation}\label{equ:well-formed_rewriting_step}
    h_v = \sum\lambda_xx+v'\rewh\sum\lambda_xr_x+v',
  \end{equation}
\end{small}
where for every $x$, $h_x=x \rewR r_x$. Note in particular that if $x$ is minimal for $<$, then $h_x = x \to x$ is the identity on $x$.

\medskip

\begin{definition}
  A vector $v$ is said to be an \emph{$h$-normal form} if it is a normal
  form for $\rewh$.
\end{definition}


\begin{example}\label{ex:h_norma_form}
  Let $X=\{x,y,z,t\}$, $x\rewR y$, $y \rewR z + t$, $z \rewR y - t$. Note that this is not terminating since we have the infinite loop $y \rewR z + t \rewR (y - t) + t = y$. We choose the order $x > y > z,t$, and the following distinguished rewrite rules: $h_x = x \rewh y$ and $h_y = y \rewh z + t$. Then the $R$-normal forms are the $\lambda_t t$, while the $h$-normal forms are all the expressions of the form $\lambda_t t + \lambda_z z$.
\end{example}


\begin{lemma}\label{lem:h_normal_forms}
  Let $v$ be a vector in $\KX$. Either $v$ is minimal for $<$, or there exists $v'<v$ such that $v\rewh v'$. In particular, $h$-normal forms are
  precisely the minimal elements of $\KX$ for $<$. 
\end{lemma}

\medskip

For each $v\in\KX$ and strategy local strategy $h$, there exists at most one $v'$ such that $v \rewh v'$,
and $\rewh$ is compatible with the termination order $<$. As a
consequence, any $v \in \KX$ is sent by multiple applications of $\rewh$
to a unique $h$-normal form that we denote by $H(v)$. This defines a map
$H : \KX \to \KX$.  

\begin{proposition}\label{prop:linearity_of_H}
  The map $H$ is a linear projector, in the sense that for all $u,v \in \KX$ and $\lambda \in \K$, $H(u+v) = H(u) + H(v)$, $H(\lambda u) = \lambda H(u)$ and
  $H(H(u)) = H(u)$.
\end{proposition}

\begin{proof}
  The $h$-normal forms are closed under sums, so that $H(H(v))=H(v)$ for
  every $v$, that is $H$ is a projector. Moreover, if $u \rewh u'$ and
  $v \rewh v'$, then we have $u + v \rewh u' + v'$. Iterating~$\rewh$, we
  get $H(u + v) = H (H(u)+H(v))=H(u)+H(v)$. 
\end{proof}

\section{A confluence criterion}
In this section we investigate the confluence properties of $R$.
The main idea behind this section is that under suitable hypothesis $\rewh$ should form a terminating, confluent subrelation of $\rewR$.

We start in Definition \ref{def:standardisation_property} and the following propositions by relating the confluence of $\rewR$ to properties on $h$.
Then Theorem~\ref{thm:confluence_criterion}, we prove a confluence
criterion to check whether $R$ satisfies Definition~\ref{def:standardisation_property}.

\begin{definition}\label{def:standardisation_property}
  We say that $R$ is \emph{h-confluent} if for every rewrite rule $x\rewR v\in R$, we have $H(x-v) = 0$.
\end{definition}

\begin{example}
  Let us take the same example as in Example \ref{ex:h_norma_form}. We have three equations to check:
  \begin{small}
    \[
    H(x) = z + t = H(y),\qquad H(y) = z + t = H(z + t),\qquad H(z) = z = H(y - t),
    \]
  \end{small}
    and so $R$ is $h$-confluent. Replacing the rule $z \rewR y - t$ by $z \rewR y$, we get $H(z) = z$ and $H(y) = z + t$, so $R$ is not $h$-confluent anymore. 
\end{example}

\begin{proposition}\label{prop:equationnal_theory}
  If $R$ is $h$-confluent, then
  $u \equivR v$ if and only if $H(u-v)=0$.
\end{proposition}

\begin{proof}
The relation $\equivR$ is the closure of $\rewR$ under transitivity, symmetry and sum. Since the relation $H(u - v) = 0$ is closed under these operations, we get one implication.

Reciprocally, if $H(u - v) = 0$ then by definition of $H$ we have $u \equivh v$, and in particular $u \equivR v$.
\end{proof}

\begin{proposition}\label{prop:h-conf_implies_conf}
If $R$ is $h$-confluent then $\rewR$ is confluent.
\end{proposition}
\begin{proof}
  Let $v,\ v_1,\ v_2\in\KX$ be such that $v\transR v_i$, for $i=1,\ 2$.
  From Proposition~\ref{prop:equationnal_theory}, $v_1-v_2$ belongs to
  $\ker(H)$, that is $H(v_1)=H(v_2)$. Denoting by $u$ the common value, we get
  $v_i\transR u$, which proves the proposition.
\end{proof}

Note that the previous proposition is a sufficient but not a necessary condition: taking $X$ to be the integers, with the relations $n \rewR n+1$ is confluent, but there exist no local strategy $h$ making $R$ $h$-confluent. 

We now introduce our criterion to show that $R$ is $h$-confluent. For that, we assume that the set of relations $R$ is equipped with a well-founded order $\prec$ satisfying the following decreasingness property:

\begin{definition}\label{proper:decreasingness_property}
  We say that $R$ is \emph{locally $h$-confluent} if for every
  $x \in X$ and $f=x\rewR v$, then letting $h_x=x\rewh r_x$, we
  have the confluence diagram:
  \begin{small}
    \[
    \xymatrix @C = 2.5em @R = 2.5em{
      x 
      \ar [r] ^{f}
      \ar[d] _{h_x}
      &
      v
      \ar@{<.>} [d] ^{*}
      \\
      r_x
      \ar@{<.>} [r] ^{*}
      & 
      v',
    }
    \]
  \end{small}
  where each rewriting step occurring in the dotted arrows is strictly
  smaller than $f$ with respect to  $\prec$.
\end{definition}

\begin{example}
  Continuing with Example \ref{ex:h_norma_form}, let us define an order $\prec$ on $R$ by the following ordering: $(x \rewR y), (y \rewR z + t) \prec (z \rewR y - t)$. This is guided by the heuristic that rules advancing towards an $h$-normal form should be favored over rules that do not: here $z$ is an $h$-normal form so the rule rewriting it is large for $\prec$. The following diagrams show that $R$ is locally $h$-confluent:
  \begin{small}
    \[
    \xymatrix @C = 2.5em @R = 2.5em{
      x \ar [r] _{R}  
      \ar [d] _{h_x}   
      & y 
      \ar@{=} [d]
      \\
      y
      \ar@{=} [r]
      & y
    }
    \qquad
    \xymatrix @C = 2.5em @R = 2.5em{
      y \ar [r] _{R}  
      \ar [d] _{h_y}   
      & z + t
      \ar@{=} [d]
      \\
      z + t
      \ar@{=} [r]
      & z + t
    }
    \qquad
    \xymatrix @C = 2.5em @R = 2.5em{
      z \ar [r] _{R}  
      \ar@{=} [d] _{h_z}   
      & y - t
      \ar [d] ^{R}
      \\
      z
      \ar@{=} [r]
      & z
    }
    \]
  \end{small}
\end{example}
\medskip

Our main result is the following.
\smallskip

\begin{theorem}\label{thm:confluence_criterion}
  If $R$ is locally $h$-confluent, then $R$ is $h$-confluent. In particular, $\rewR$ is confluent.
\end{theorem}

\begin{proof}
  We reason by induction on $r$ according to the order $\prec$. Looking at the square corresponding to $r$:
  \begin{small}
    \[
    \xymatrix @C = 2.5em @R = 2.5em{
      x 
      \ar [r] ^{r}
      \ar[d] _{h_x}
      &
      v
      \ar@{<.>} [d] ^{*}
      \\
      r_x
      \ar@{<.>} [r] ^{*}
      & 
      v',
    }
    \]
  \end{small}
 we have $H(x) = H(r_x)$ by definition of $H$, and $H(r_x) = H(v') = H(v)$ by induction hypothesis, which concludes the proof.
\end{proof}

\begin{remark}
  Local $h$-confluence implies that the pair of rewriting relations $(\rewh,\rewR)$ is decreasing with respect to conversions (see \cite[Definition 3]{van2008confluence}), using the order $\prec$ on $R$ and the discrete ordering on $\rewh$. 
  By \cite[Theorem 3]{van2008confluence}, this implies that $(\rewh,\rewR)$ commute. Using the fact that $\rewh \subseteq \rewR$, one can then recover that $\rewR$ is confluent.
\end{remark}

\medskip


Let us show how the Diamond Lemma fits as a particular case of our setup.
\smallskip

\begin{theorem}[\cite{MR506890}]\label{thm:diamond_lemma}
  Assume that $\rewR$ is terminating and that for every $x\in X$, $x\rewR r$ and $x\rewR r'\in R$, $r$ and $r'$ are joinable. Then, $\rewR$ is confluent.
\end{theorem}

\begin{proof}
  We define an ordering $x > y$ on $X$ as the transitive closure of the relation ``there exists $v \in \KX$ such that $x \rewR v$ and $y\in\supp(v)$''. This is well-founded since by hypothesis $\rewR$ is terminating. By definition, if $x \in X$ is not minimal for $>$, then $x$ is not an $R$-normal form. Let us fix an arbitrary rewriting step $h_x= x \rewh r_x$.  By definition of~$>$, for any $y \in \supp(r_x)$ we have $y < x$ and so $r_x < x$, which shows that  $h$ is a local strategy. Ordering the rewrite rules by their left hand sides makes $R$ locally $h$-confluent. Theorem \ref{thm:confluence_criterion} finally shows that $R$ is confluent.  
\end{proof}

\paragraph{Conclusion.} We introduced a sufficient condition, based on deterministic reduction strategies, of confluence for rewriting systems on vector spaces. As a particular case, we recover the Diamond Lemma. This work maybe extended in particular into two main directions. The first one consists in weakening our assumption on the set $\K$ of coefficients, by allowing non invertible coefficients. A second extension consists in characterising Janet bases in this framework, with the objective to develop constructive methods in the analysis and formal resolution of PDE's.

\bibliography{Biblio}

\end{document}

 	

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
