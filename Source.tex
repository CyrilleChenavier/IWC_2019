\documentclass[10pt]{easychair}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb,mathrsfs}
\pagestyle{plain}
\usepackage{enumitem} 
\usepackage{amsthm}
\usepackage{titlesec}
\usepackage[all]{xy}
\usepackage{algorithm}
\usepackage{algorithmic}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{property}[theorem]{Property}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}


\newcommand\K{\mathbb{K}}
\newcommand\KX{\K X}
\newcommand\supp{\text{supp}}
\newcommand\rewR{\underset{R}{\longrightarrow}}
\newcommand\rewh{\underset{h}{\longrightarrow}}
\newcommand\transR{\overset{*}{\rewR}}
\newcommand\transh{\overset{*}{\rewh}}
\newcommand\equivR{\underset{R}{\overset{*}{\longleftrightarrow}}}
\newcommand\equivh{\underset{h}{\overset{*}{\longleftrightarrow}}}
\newcommand\G{Gröbner}

\bibliographystyle{plain}

\newcommand\todo[1]{\textcolor{red}{#1.}}

\begin{document}

\title{The Diamond Lemma for non-terminating rewriting systems using deterministic reduction strategies}

\author{
Cyrille Chenavier\inst{1}
\and
Maxime Lucas\inst{2}
}

\institute{
  Inria Lille - Nord Europe, équipe Valse\\
  \email{cyrille.chenavier@inria.fr}
\and
Inria Rennes - Bretagne Atlantique, équipe Gallinette\\
\email{maxime.lucas@inria.fr}
}

\authorrunning{Chenavier and Lucas}
\titlerunning{Running title}

\maketitle

\begin{abstract}
  We study the confluence property for rewriting systems over vector spaces using deterministic reduction strategies. These strategies are based on the choice of standard reductions applied to basis elements. We show that the confluence property is interpreted in terms of the kernel of the operator which computes standard normal forms. We present a local criterion which enables us to check the confluence property in this framework. We show how this criterion is related to the Diamond Lemma for terminating rewriting systems.
\end{abstract}
 
\section{Introduction}

The fact that local confluence together with termination implies confluence has been known for abstract rewriting systems since Newman's work~\cite{MR0007372}. For rewriting on noncommutative polynomials, a similar result known as the Diamond lemma  was introduced by Bergman~\cite{MR506890} nearly 30 years later, in order to compute normal forms in noncommutative algebras using rewriting theory. It asserts that for terminating rewriting systems, the local confluence property can be checked on monomials. 

One difficulty of rewriting polynomials is that the naive notion of rewriting path (obtained as the closure of the generating rewriting relations under reflexivity, transitivity, sum and product by a scalar) does not terminate. Instead, one needs to first consider well-formed rewriting steps before forming the reflexive transitive closure.

Nevertheless the Diamond lemma has proved to be very useful : together with the works of Bokut~\cite{MR0506423}, it has given birth the theory of noncommutative \G\ bases~\cite{MR1299371}. The latter have provided applications to various areas of noncommutative algebra such as the study of embedding problems (which appear in the works of Bokut and Bergman), homological algebra~\cite{MR1072284, MR2110434} or Koszul duality~\cite{MR1832913, MR0265437}.

Computation of normal forms in noncommutative algebra is also used to provide formal solutions to partial differential equations. In this framework, a confluence criterion analogous to the Diamond Lemma is given by Janet bases~\cite{MR2394773}, which specify a deterministic way to reduce each polynomial into normal form using standard reductions~\cite{Mell}. The confluence criterion may then be asserted as follows: for each monomial $m$ and each non-standard reduction $m\to f$, $f$ is reducible into $\widehat{m}$, where the latter is obtained from $m$ using only standard reductions.

In the presented paper, we propose an extension of the Diamond Lemma, which offers two improvements over the one from Bergman: first it allows the treatment of non-terminating rewriting relations, and second it does not presuppose a notion of well-formed rewriting steps. This last property seems particularly promising in order to extend the Diamond Lemma to other structures.

Instead of supposing that the rewriting relation studied is terminating, we suppose given an ordering of the monomials, independent of the rewriting relation.
We then use methods based on standard reductions: for every monomial $m$, we select exactly one reduction with left-hand side $m$, which is decreasing for the ordering chosen. Such choices induce a deterministic way to reduce each polynomial, obtained by applying simultaneously standard reductions on every monomial appearing in its decomposition. When these deterministic reductions terminate, one defines an operator which maps every polynomial to its unique standard normal form.

From this operator, we define a suitable notion of confluence adapted to  our setting, and show in Proposition~\ref{prop:h-conf_implies_conf} that it implies the usual notion of confluence for the rewriting system studied. We then provide an effective method for checking this criterion in  Theorem~\ref{thm:confluence_criterion}. This method is based on a local analysis corresponding to checking local confluence on monomials. In particular, when the rewriting system is terminating, we show (Theorem~\ref{thm:diamond_lemma}) that we recover the Diamond Lemma as a particular case of Theorem~\ref{thm:confluence_criterion}.

\section{Local strategies and $h$-normal forms}

We fix a commutative field $\K$ as well as a well-founded ordered set
$(X,<)$. We denote by $\KX$ the vector space spanned by~$X$: an element
$v\in\KX$ is a finite formal linear combination of elements of $X$ with
coefficients in $\K$. In particular, for every $v\in\KX$, there exists a
unique finite set $\supp(v)\subset X$, called the \emph{support} of $v$,
such that
\begin{equation}\label{equ:support}
  v=\sum_{x\in\supp(v)}\lambda_xx\ \text{and}\ x\in\supp(v)\Rightarrow\lambda_x
  \neq 0.
\end{equation}

\smallskip
\noindent
We denote by $\supp(v)^c=X\setminus\supp(v)$. The sum of
$u=\sum\lambda_xx$ and $v=\sum\mu_xx$ equals $\sum(\lambda_x+\mu_x)x$ and
the product of $\lambda\in\K$ by $v$ equals $\sum(\lambda\lambda_x)x$. We
extend the order $<$ into the multiset order, still written $<$, on
$\KX$: we have $u<v$ if for every $x\in\supp(u)\cap\supp(v)^c$, there
exists $y\in\supp(v)\cap\supp(u)^c$ such that $y>x$.

\medskip

We fix a set $R\subseteq X\times\KX$ which represents rewrite rules of
the form $x\rewR r$. The set $R$ induces the rewriting relation on $\KX$,
still written $\rewR$, defined as follows:
\begin{equation}\label{equ:rewriting_step}
  \sum\lambda_xx+v\rewR\sum\lambda_xr_x+v,
\end{equation}
whenever $\lambda_x\neq 0$, $x\rewR r_x\in R$ and $x\notin\supp(v)$. 

\begin{definition}
A \emph{local strategy} for $R$ is the choice, for every $x\in X$ not minimal for $<$, of a rewriting rule $h_x=x \rewR r_x$ such that $r_x < x$.
\end{definition}

Suppose chosen such a local strategy $h$. 
Any vector $v$ can be decomposed in a unique way as
$\sum\lambda_xx+v'$, where $y\in\supp(v')$ implies that $y$ is minimal
for $<$, and $x\in\supp(v)\cap\supp(v')^c$ is not. We define a rewriting
relation $\rewh$ as follows:
\begin{equation}\label{equ:well-formed_rewriting_step}
  \sum\lambda_xx+v'\rewh\sum\lambda_xr_x+v',
\end{equation}
where for every $x$, $h_x=x \rewR r_x$.

\medskip

\begin{definition}
  A vector $v$ is said to be a \emph{$h$-normal form} if it is a normal
  form for $\rewh$.
\end{definition}


\begin{example}\label{ex:h_norma_form}
Let $X=\{x,y,z,t\}$, $x\rewR y$, $y \rewR z + t$, $z \rewR y - t$. Note that this is not terminating since we have the infinite loop $y \rewR z + t \rewR (y - t) + t = y$. We choose the order $x > y > z$, and the following distinguished rewrite rules: $h_x = x \rewh y$, $h_y = y \rewh z + t$. Then the $R$-normal forms are the $\lambda_t t$, while the $h$-normal form are all the $\lambda_t t + \lambda_z z$.
\end{example}


\begin{lemma}\label{lem:h_normal_forms}
  Let $v$ be a vector in $\KX$. Either $v$ is minimal for $<$, or there exists $v'<v$ such that $v\rewh v'$. In particular, $h$-normal forms are
  precisely the minimal elements of $\KX$ for $<$. 
\end{lemma}

\medskip

For each $v\in\KX$, there exists at most one $v'$ such that $v \rewh v'$,
and $\rewh$ is compatible with the termination order $<$. As a
consequence, any $v \in \KX$ is sent by multiple applications of $\rewh$
to a unique $h$-normal form that we denote by $H(v)$. This defines a map
$H : \KX \to \KX$.  

\begin{proposition}\label{prop:linearity_of_H}
  The map $H$ is a linear projector.
\end{proposition}

\begin{proof}
  The $h$-normal forms are closed under sums, so that $H(H(v))=H(v)$ for
  every $v$, that is $H$ is a projector. Moreover, if $u \rewh u'$ and
  $v \rewh v'$, then we have $u + v \rewh u' + v'$. Iterating~$\rewh$, we
  get $H(u + v) = H (H(u)+H(v))=H(u)+H(v)$. 
\end{proof}

\section{A confluence criterion}

\begin{definition}\label{def:standardisation_property}
  We say that $R$ is \emph{h-confluent} if for every rewrite rule $x\rewR v\in R$, we have $\ x-v\in\ker(H)$.
\end{definition}

\begin{example}
Let us take the same example as in \ref{ex:h_norma_form}. Then $H(x) = H(y) = z + t$, with $H(z) = z = H(y - t)$, and so $R$ is $h$-confluent. Replacing the rule $z \rewR y - t$ by $z \rewR y$, we get $H(z) = z$ and $H(y) = z + t$, so $R$ is not $h$-confluent anymore. 
\end{example}

\begin{proposition}\label{prop:equationnal_theory}
  If $R$ is $h$-confluent, then
  $u \equivR v$ if and only if $u-v\in\ker(H)$.
\end{proposition}

\begin{proof}
The relation $\equivR$ is the closure of $\rewR$ under transitivity, symmetry and sum. Since the relation $u - v \in \ker(H)$ is closed under these operations, we get one implication.

Reciprocally, if $u - v \in \ker(H)$ then by definition of $H$ we have $u \equivh v$, and in particular $u \equivR v$.
\end{proof}

\begin{proposition}\label{prop:h-conf_implies_conf}
If $R$ is $h$-confluent, then $\rewR$ is confluent.
\end{proposition}
\begin{proof}
  Let $v,\ v_1,\ v_2\in\KX$ be such that $v\transR v_i$, for $i=1,\ 2$.
  From Proposition~\ref{prop:equationnal_theory}, $v_1-v_2$ belongs to
  $\ker(H)$, that is $H(v_1)=H(v_2)$. Denoting by $u$ the common value, we get
  \[
    \xymatrix @C = 2.5em @R = 2.5em{
    v 
    \ar [r] ^{*}
    \ar[d] _{*}
     &
      v_1
      \ar@{>} [d] ^{*}
      \\
      v_2
      \ar@{>} [r] _{*}
      & 
      u.
    }
  \]
\end{proof}

In Theorem~\ref{thm:confluence_criterion}, we introduce a confluence
criterion when $R$ satisfies~\ref{def:standardisation_property}. For
that, we assume that $R$ is equipped with a well-founded order $\prec$
satisfying the following decreasingness property:

\begin{definition}\label{proper:decreasingness_property}
  We say that $R$ is \emph{locally $h$-confluent} if for every non
  minimal $x\in X$ and $r=x\rewR v$, then letting $h_x=x\rewh r_x$, we
  have the confluence diagram:
  \[
    \xymatrix @C = 2.5em @R = 2.5em{
    x 
    \ar [r] ^{r}
    \ar[d] _{h_x}
     &
      v
      \ar@{.>} [d] ^{*}
      \\
      r_x
      \ar@{.>} [r] ^{*}
      & 
      v',
    }
  \]
  where each rewriting step occurring in the dotted arrows are strictly
  smaller than $r$ for $\prec$.
\end{definition}

\begin{example}
Continuing with Example \ref{ex:h_norma_form}, let us define an order $\prec$ on $R$ as follows:
\[
(x \rewR y), (y \rewR z + t) \prec (z \rewR y - t).
\]
This is guided by the heuristic that rules advancing towards an $h$-normal form should be favored over rules that do not: here $z$ is an $h$-normal form so the rule rewriting it is large for $\prec$. The following diagrams show that $R$ is locally $h$-confluent:
\[
   \xymatrix @C = 2.5em @R = 2.5em{
   x \ar [r] _{R}  
    \ar [d] _{h_x}   
   & y 
   \ar@{=} [d]
   \\
    y
    \ar@{=} [r]
    & y
    }
    \qquad
   \xymatrix @C = 2.5em @R = 2.5em{
   y \ar [r] _{R}  
    \ar [d] _{h_y}   
   & z + t
   \ar@{=} [d]
   \\
    z + t
    \ar@{=} [r]
    & z + t
    }
     \qquad
   \xymatrix @C = 2.5em @R = 2.5em{
   z \ar [r] _{R}  
    \ar@{=} [d] _{h_z}   
   & y - t
   \ar [d] _{R}
   \\
    z
    \ar@{=} [r]
    & z
    }
\]    
\end{example}
\medskip

Our main result is the following.
\smallskip

\begin{theorem}\label{thm:confluence_criterion}
  If $R$ is locally $h$-confluent, then $R$ is $h$-confluent. In particular, $\rewR$ is confluent.
\end{theorem}

\begin{proof}
 We reason by induction on $r$. Looking at the square corresponding to $r$:
  \[
    \xymatrix @C = 2.5em @R = 2.5em{
    x 
    \ar [r] ^{r}
    \ar[d] _{h_x}
     &
      v
      \ar@{.>} [d] ^{*}
      \\
      r_x
      \ar@{.>} [r] ^{*}
      & 
      v',
    }
  \]
 we have $H(x) = H(r_x)$ by definition of $H$, and $H(r_x) = H(v') = H(v)$ by induction hypothesis, which concludes the proof.
\end{proof}
\medskip


Let us show how the Diamond Lemma fits as a particular case of our set up.
\smallskip

\begin{theorem}[\cite{MR506890}]\label{thm:diamond_lemma}
  Assume that $\rewR$ is terminating and that for every $x\in X$, $x\rewR r$ and $x\rewR r'\in R$, $r$ and $r'$ are joinable. Then, $\rewR$ is confluent.
\end{theorem}

\begin{proof}
  We define the relation $x > y$ on $X$ whenever $x \rewR v$ exists such that $y\in\supp(v)$. The induced order relation is well-founded. By definition, if $x \in X$ is not minimal for $>$, then $x$ is not an $R$-normal form. Let us fix an arbitrary rewriting step $h_x= x \rewh r_x$.  By definition of~$>$, $r_x < x$ so that $h$ is a local strategy. Ordering the rewrite rules by their left hand sides makes $R$ locally $h$-confluent. Theorem \ref{thm:confluence_criterion} finally shows that $R$ is confluent.  
\end{proof}

\bibliography{Biblio}

\end{document}

